<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="http://cmsj.net/theme/css/style.less">
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->


  <link rel="icon" type="image/vnd.microsoft.icon" href="http://cmsj.net/">
  <link rel="stylesheet" type="text/css" href="http://cmsj.net/theme/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="http://cmsj.net/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="http://cmsj.net/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto+Mono">
  <link rel="stylesheet" type="text/css" href="http://cmsj.net/theme/css/fontawesome-all.min.css">
  <link rel="stylesheet" type="text/css" href="http://cmsj.net/theme/css/hatena-bookmark-icon.css">

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Chris Jones">
  <meta name="description" content="Posts and writings by Chris Jones">
  <meta name="og:site_name" content="cmsj.net">

  <!-- Twitter Card -->


  <meta name="og:url" content="http://cmsj.net/2010/07/06/who-wants-to-see-something-really-ugly.html" />
  <meta name="og:title" content="Who wants to see something really ugly?" />
  <meta name="og:description" content="I think it should be abundantly clear from my postings here that I'm not a very good programmer, and this means I give myself a lot of free rope to do some very stupid things. I'm in constant need of debugging information and in Terminator particularly where we have lots â€¦" />
  <meta name="keywords" content="">


  <link href="http://cmsj.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="cmsj.net Atom" />


  <title>
    cmsj.net
&ndash; Who wants to see something really ugly?  </title></head>

<body>
  <main>
    <header>
      <div class="site-name">
        <a href="http://cmsj.net">cmsj.net</a>
      </div>
      <p>
        <a href="http://cmsj.net/archives.html"><i class="fas fa-archive"></i> Archive</a>
      </p>
    </header>

<article>
  <div class="article__title">
    <h1><a href="http://cmsj.net/2010/07/06/who-wants-to-see-something-really-ugly.html">Who wants to see something really ugly?</a></h1>
  </div>
  <div class="article__meta">
    <p class="article__meta__post-date">Posted on: Tue 06 July 2010</p>
    </p>
  </div>
  <div class="article__text">
    <p>I think it should be abundantly clear from my postings here that I'm not a very good programmer, and this means I give myself a lot of free rope to do some very stupid things.
I'm in constant need of debugging information and in Terminator particularly where we have lots of objects all interacting and reparenting all the time. We've had a simple dbg() method for a long time, but I was getting very bored of typing out dbg('Class::method:: Some message about %d' % foo), so I decided to see what could be done about inferring the Class and method parts of the message.
It turns out that python is very good at introspecting its own runtime, so back in January, armed with my own stupidity and some help from various folks on the Internet, I came up with the following:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="k">output</span><span class="w"></span>
<span class="n">DEBUG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">additionally</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">filenames</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">debugging</span><span class="w"></span>
<span class="n">DEBUGFILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="k">for</span><span class="p">.</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">classes</span><span class="w"></span>
<span class="n">DEBUGCLASSES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="k">for</span><span class="p">.</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">methods</span><span class="w"></span>
<span class="n">DEBUGMETHODS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">dbg</span><span class="p">(</span><span class="nf">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Print a message if debugging is enabled&quot;&quot;&quot;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">DEBUG</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">stackitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inspect</span><span class="p">.</span><span class="n">stack</span><span class="p">()</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="n">parent_frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stackitem</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="k">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent_frame</span><span class="p">.</span><span class="n">f_code</span><span class="p">.</span><span class="n">co_name</span><span class="w"></span>
<span class="w">        </span><span class="k">names</span><span class="p">,</span><span class="w"> </span><span class="n">varargs</span><span class="p">,</span><span class="w"> </span><span class="n">keywords</span><span class="p">,</span><span class="w"> </span><span class="n">local_vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inspect</span><span class="p">.</span><span class="n">getargvalues</span><span class="p">(</span><span class="n">parent_frame</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>
<span class="w">            </span><span class="n">self_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">names</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>
<span class="w">            </span><span class="n">classname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_vars</span><span class="o">[</span><span class="n">self_name</span><span class="o">]</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="w"></span>
<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">IndexError</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="n">classname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;noclass&quot;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">DEBUGFILES</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stackitem</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="w"></span>
<span class="w">            </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent_frame</span><span class="p">.</span><span class="n">f_code</span><span class="p">.</span><span class="n">co_filename</span><span class="w"></span>
<span class="w">            </span><span class="n">extra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot; (%s:%s)&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>
<span class="w">            </span><span class="n">extra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">DEBUGCLASSES</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">classname</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">DEBUGCLASSES</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">DEBUGMETHODS</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="err">[]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">DEBUGMETHODS</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>
<span class="w">            </span><span class="k">print</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;%s::%s: %s%s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">classname</span><span class="p">,</span><span class="w"> </span><span class="k">method</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="p">,</span><span class="w"> </span><span class="n">extra</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">IOError</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="n">pass</span><span class="w"></span>
</code></pre></div>

<p>How's about that for shockingly bad? ;)
It also adds a really impressive amount of overhead to the execution time.
I added the DEBUGCLASSES and DEBUGMETHODS lists so I could cut down on the huge amount of output - these are hooked up to command line options, so you can do something like "terminator -d --debug-classes=Terminal" and only receive debugging messages from the Terminal module.
I'm not exactly sure what I hope to gain from this post, other than ridicule on the Internet, but maybe, just maybe, someone will pop up and point out how stupid I am in a way that turns this into a 2 line, low-overhead function :D</p>
  </div>

</article>


  </main>
    <footer>
      <div class="author__logo">
          <img src="http://cmsj.net/theme/images/logo.png" alt="logo">
      </div>
      <section class="author">
        <div class="author__name">
          <a href="http://cmsj.net/pages/about.html">Chris Jones</a>
          <p></p>
        </div>
        <div class="author__link">
          <ul>
            <li>
              <a href="https://twitter.com/cmsj" target="_blank" title="twitter">
                <i class="fab fa-twitter-square"></i>
              </a>
            </li>
            <li>
              <a href="https://github.com/cmsj" target="_blank" title="github">
                <i class="fab fa-github-square"></i>
              </a>
            </li>
            <li>
              <a href="http://cmsj.net/feeds/all.atom.xml" target="_blank" title="Feed">
                <i class="fas fa-rss-square"></i>
              </a>
            </li>
          </ul>
        </div>
      </section>
      <div class="ending-message">
        <p>&copy; Chris Jones. Powered by <a href="http://getpelican.com" target="_blank">Pelican</a>, Theme is using <a href="https://github.com/laughk/pelican-hss" target="_blank">HSS</a>. </p>
      </div>
    </footer>
</body>
</html>