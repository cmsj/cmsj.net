title: My new project: juicyD (maybe)
slug: my-new-project-juicyd-maybe
date: 2008-12-17


Being a sysadmin I tend to install operating systems quite often on various bits of hardware. This means a lot of CDs. I carry at least 4 CDs in my laptop sleeve and that's not really enough, plus I sometimes burn CDs to update firmwares in laptops, etc.
It doesn't sound like the end of the world, because it's not, but that doesn't mean the status quo is worth keeping. I've been thinking for a while now that it would be great to have a solid-state device I could use as a USB CDROM. I could load it up with a bunch of ISOs and boot from them without having to carry round a load of CDs or waste blank CDs for BIOS/firmware upgrades that are only a few MB.
A little research showed that, as ever, Linux was the perfect candidate because of its USB Gadget subsystem, which lets it act as USB Mass Storage, USB Ethernet, USB Serial, USB MIDI and other things.
While the Mass Storage support currently in the kernel doesn't include CDROM support, there is [a patch](http://www.kernel.org/pub/linux/kernel/people/gregkh/gregkh-2.6/gregkh-04-usb/usb-g_file_storage-add-cd-rom-emulation.patch "g_file_storage CD-ROM patch") kicking around which adds it as an option when loading the g\_file\_storage kernel module.
Next up - selecting some suitable hardware to test this on.
![Atmel NGW100](http://www.avr32linux.org/twiki/pub/Main/ModifyTheNGW100/ngw_overview.png)
[Atmel](http://www.atmel.no/ "Atmel")'s [NGW100](http://www.atmel.com/dyn/products/tools_card.asp?tool_id=4102) ticks all of the boxes for a test rig, it's got a serial port, a USB port, a power port and an MMC card slot. It's much bigger than a gumstix, and not powered by USB (although there is a[dubious sounding hardware hack](http://nickstallman.net/node/11) for this), but this is a low cost board to prove the project is possible.
The board comes with linux pre-installed, but the kernel isn't super-new, and since the CD-ROM patch isn't in mainline yet, I needed to get the board up to date.
Fortunately there is a great community of people around embedded linux. With a bunch of googling and help from HcE on \#elinux, last night I got stuck in and built a toolchain, kernel, root image and upgraded [the bootloader](http://www.atmel.no/buildroot/buildroot-u-boot.html). This morning I [uploaded a new image](http://support.atmel.no/knowledgebase/avr32studiohelp/com.atmel.avr32.tool.ngw100/html/firmware_upgrade.html#With_serial_link) with a slightly old version of the CD-ROM patch (because I only just found the newer version while writing this post).
There's also plenty of information around about this, but it can be a challenge to wade into a brand new system and immediately know the right places to look (the [avr32linux.org wiki](http://avr32linux.org/twiki/bin/view) turns out to be supremely useful, as was HcE).
So the question is, does it work? The simple anwer is yes, a Linux machine sees it as a CD-ROM drive and can mount it as such. The more complex, and slightly worse answer is not yet, because a test against a BIOS didn't work. It's possible this is a [hardware issue](http://www.avrfreaks.net/wiki/index.php/VBUS_fix), but it could be a software issue too, so I'm casting around for ideas :)
(the name "juicyD" is probably temporary, and I noticed about 6 hours after I chose it that someone [commented](http://www.tenshu.net/archives/2007/06/03/transcoding-video-for-the-ps3-in-ubuntu/#comment-56) on an earlier post with that nick a while ago. Weird)
